<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Gesti√≥n de Playas</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #cce6ff;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    .container {
      background-color: white;
      padding: 20px;
      border-radius: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
      width: 400px;
    }

    .playa {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #f5f5f5;
      padding: 10px;
      border-radius: 10px;
      margin-bottom: 10px;
    }

    .nombre-playa {
      font-size: 1.2em;
      font-weight: bold;
    }

    .fecha {
      font-size: 0.8em;
      color: gray;
    }

    .acciones {
      display: flex;
      gap: 10px;
    }

    .boton {
      border: none;
      background-color: transparent;
      cursor: pointer;
      font-size: 1.3em;
    }

    .agregar {
      text-align: center;
      font-size: 2em;
      color: #7d4cff;
      cursor: pointer;
    }
    .modal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-color: rgba(0,0,0,0.5);
      display: none; /* empieza oculto */
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .modal.show {
      display: flex;
    }

    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 10px;
      width: 300px;
    }
  </style>
</head>
<body>
   <div class="container" id="contenedor-playas">

    {% for playa in playas %}
      <div class="playa">
        <div>
          <div class="nombre-playa">{{ playa.nombre }}</div>
          <div class="fecha">Lugar: {{ playa.lugar }}<br>Lat: {{ playa.latitud }} - Long: {{ playa.longitud }}</div>
        </div>
        <div class="acciones">
          <button class="boton" onclick="solicitarInfo('{{ playa.nombre }}')">‚ôªÔ∏è</button>
          <button class="boton" onclick="eliminarPlaya('{{ playa.id }}')">üóëÔ∏è</button>
        </div>
      </div>
    {% empty %}
      <p>No hay playas registradas.</p>
    {% endfor %}

    <!-- Bot√≥n para agregar m√°s playas -->
    <div class="agregar" onclick="agregarPlaya()">+</div>
  </div>
  <!-- Modal -->
<div id="modalAgregar" class="modal">
  <div class="modal-content">
    <h3>Agregar Playa</h3>
    <input type="text" id="inputNombre" placeholder="Nombre de la playa"><br><br>
    <input type="text" id="inputLugar" placeholder="Lugar / ciudad"><br><br>
    <button onclick="enviarNuevaPlaya()">Guardar</button>
    <button onclick="cerrarModal()">Cancelar</button>
  </div>
</div>

<script>
  function solicitarInfo(nombre) {
    alert('Solicitando info para: ' + nombre);
    // Aqu√≠ har√≠as la llamada a la API con fetch()
   }

  function eliminarPlaya(id) {
  if (!confirm("¬øEst√°s seguro de que quer√©s eliminar esta playa?")) return;

  fetch(`/api/eliminar-playa/`, {
    method: 'POST',
    headers: {
      'X-CSRFToken': getCookie('csrftoken'),
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({ id: id })
  })
  .then(res => res.json())
  .then(data => {
    if (data.ok) {
      alert("Playa eliminada correctamente");
      location.reload(); // o quit√° el elemento del DOM
    } else {
      alert("Error: " + data.error);
    }
  })
  .catch(() => alert("Error al conectar con el servidor"));
}

  function agregarPlaya() {
    document.getElementById("modalAgregar").classList.add("show");
  }

  function cerrarModal() {
    document.getElementById("modalAgregar").classList.remove("show");
  }

  function enviarNuevaPlaya() {
    const nombre = document.getElementById("inputNombre").value;
    const lugar = document.getElementById("inputLugar").value;

    fetch('/api/agregar-playa/', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': getCookie('csrftoken')  // Necesario para Django
      },
      body: JSON.stringify({ nombre, lugar })
    })
    .then(res => res.json())
    .then(data => {
      if (data.ok) {
        alert("Playa agregada correctamente");
        cerrarModal();
        location.reload(); // O actualiz√° din√°micamente si quer√©s
      } else {
        alert(data.error || "No se pudo agregar la playa");
      }
    })
    .catch(() => alert("Error al conectar con el servidor"));
  }

  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
      const cookies = document.cookie.split(';');
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.substring(0, name.length + 1) === (name + '=')) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }
</script>
</body>
</html>
